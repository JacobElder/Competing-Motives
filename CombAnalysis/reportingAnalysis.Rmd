---
title: "R Notebook"
output:
  html_document:
    toc: true
    number_sections: true
    theme: united
    df_print: paged
---

```{r,include=FALSE}
library(compiler)
library(readbulk) 
library(psych)
library(forcats)
library(igraph)
library(MASS)
library(lme4)
library(lmerTest)
library(cluster)
library(Kendall)
library(readr)
library(psych)
library(igraph)
library(plyr)
library(dplyr)
library(ggplot2)
library(reshape2)
library(tidyr)
library(gtools)
library(sjstats)
library(brms)
library(optimx)
library(ggeffects)
library(sjPlot)
library(corrr)
library(r2glmm)
library(ggpubr)
library(grid)
library(broom.mixed)
library(tidyverse)
library(wesanderson)
logit2prob <- function(logit){
  odds <- exp(logit)
  prob <- odds / (1 + odds)
  return(prob)
}
```

```{r}
plotDir <- "/Volumes/GoogleDrive/My Drive/Volumes/Research Project/Competing Motives/Plots/"
```


```{r, include=FALSE}
setwd("~/Google Drive/Volumes/Research Project/Competing Motives/Data Analysis/")
fullTD1 <- read.csv("fullDf.csv")
reValDf1 <- read.csv("reEvalDfnew.csv")
params <- read.csv("./Study 1 Parameters/sim2CM_RBparams.csv")
indDiff <- read.csv("CompMot_Scored.csv")
reValDf1$valence <- as.factor(reValDf1$valence)
levels(reValDf1$valence) <- c("Neg", "Pos")
reValDf1$propT <- as.factor(reValDf1$propT)
levels(reValDf1$propT) <- c("Low","Med","High")
fullTD1$compMotC <- as.factor(fullTD1$compMotC)
levels(fullTD1$compMotC) <- c("Aligned", "Compete")
fullTD1$compMotC2 <- as.factor(fullTD1$compMotC2)
levels(fullTD1$compMotC2) <- c("Aligned", "Compete")
fullTD1$compMotC3 <- as.factor(fullTD1$compMotC3)
levels(fullTD1$compMotC3) <- c("Aligned", "Compete")
fullTD1$pair <- as.factor(fullTD1$pair)
levels(fullTD1$pair) <- c("NN", "PN", "PP")
fullTD1$chooseGroup <- fullTD1$chooseGroup + 1
fullTD1$choice <- as.factor(fullTD1$choice-1)
fullTD1$incong <- as.factor(ifelse(fullTD1$pairCong == 2, "cong", "incong"))
fullTD1$SimRminL <- fullTD1$simR - fullTD1$simL

fullTD1 <- merge(fullTD1, indDiff, by = "subID")
reValDf1 <- merge(reValDf1, indDiff, by = "subID")

reValDf1$unseen <- 0

fullTD1$condition <- "Latino"
reValDf1$condition <- "Latino"
fullTD1$study <- "S1"

reValDf1$propT <- as.factor(reValDf1$propT)
contrasts(reValDf1$propT) = contr.poly(levels(reValDf1$propT))

fullTD1$runSumRLDiff <- fullTD1$runSumR - fullTD1$runSumL

fullTD1$trialTotal.Z <- scale(fullTD1$trialTotal)
fullTD1$runSumRLDiff.Z <- scale(fullTD1$runSumRLDiff)
```

```{r,include=FALSE}
setwd("~/Google Drive/Volumes/Research Project/Competing Motives/Data Analysis/Study2/output/")
fullTD2 <- read.csv("fullDf.csv")
reValDf2 <- read.csv("reEvalDf.csv")
params2 <- read.csv("/Volumes/GoogleDrive/My Drive/Volumes/Research Project/Competing Motives/Data Analysis/Study2/Analysis/Study 2 Params/sim2CM_RBparams.csv")
reValDf2$valence <- as.factor(reValDf2$valence)
levels(reValDf2$valence) <- c("Neg", "Pos")
reValDf2$propT <- as.factor(reValDf2$propT)
levels(reValDf2$propT) <- c("Low","Med","High")
fullTD2$compMotC <- as.factor(fullTD2$compMotC)
levels(fullTD2$compMotC) <- c("Aligned", "Compete")
fullTD2$compMotC2 <- as.factor(fullTD2$compMotC2)
levels(fullTD2$compMotC2) <- c("Aligned", "Compete")
fullTD2$compMotC3 <- as.factor(fullTD2$compMotC3)
levels(fullTD2$compMotC3) <- c("Aligned", "Compete")
fullTD2$pair <- as.factor(fullTD2$pair)
levels(fullTD2$pair) <- c("NN", "PN", "PP")
fullTD2$pairCong <- as.factor(fullTD2$pairCong)
levels(fullTD2$pairCong) <- c("NN", "PN", "PP")
fullTD2$pairCong <- relevel(fullTD2$pairCong, "PN")
fullTD2$chooseGroup <- as.factor(fullTD2$chooseGroup)
fullTD2$chooseAP <- as.factor(ifelse(fullTD2$AP > .5, 1, 0))
fullTD2$incong <- as.factor(ifelse(fullTD2$pairCong == "PN", "cong", "incong"))
fullTD2$SimRminL <- fullTD2$simR - fullTD2$simL

fullTD2$condition <- "Asian"
reValDf2$condition <- "Asian"
fullTD2$study <- "S2"

reValDf2$propT <- as.factor(reValDf2$propT)
levels(reValDf2$propT) <- c("Low","Med","High")
contrasts(reValDf2$propT) = contr.poly(levels(reValDf2$propT))

fullTD2$runSumRLDiff <- fullTD2$runSumR - fullTD2$runSumL

fullTD2$runSumRLDiff <- scale(fullTD2$runSumRLDiff)
fullTD2$trialTotal.Z <- scale(fullTD2$trialTotal)
```

```{r,include=FALSE}
setwd("~/Google Drive/Volumes/Research Project/Competing Motives/Data Analysis/Study3/output/")
fullTD3 <- read.csv("fullDf.csv")
reValDf3 <- read.csv("reEvalDf.csv")
params3_D <- read.csv("/Volumes/GoogleDrive/My Drive/Volumes/Research Project/Competing Motives/Data Analysis/Study3/Analysis/Study 3 Params/sim2CM_RBparamsD.csv")
params3_R <- read.csv("/Volumes/GoogleDrive/My Drive/Volumes/Research Project/Competing Motives/Data Analysis/Study3/Analysis/Study 3 Params/sim2CM_RBparamsR.csv")
reValDf3$propT <- as.factor(reValDf3$propT)
levels(reValDf3$propT) <- c("Low","Med","High")
reValDf3$valence <- as.factor(reValDf3$valence)
levels(reValDf3$valence) <- c("Neg", "Pos")
fullTD3$compMotC <- as.factor(fullTD3$compMotC)
levels(fullTD3$compMotC) <- c("Aligned", "Compete")
fullTD3$compMotC2 <- as.factor(fullTD3$compMotC2)
levels(fullTD3$compMotC2) <- c("Aligned", "Compete")
fullTD3$compMotC3 <- as.factor(fullTD3$compMotC3)
levels(fullTD3$compMotC3) <- c("Aligned", "Compete")
fullTD3$pair <- as.factor(fullTD3$pair)
levels(fullTD3$pair) <- c("NN", "PN", "PP")
fullTD3$pairCong <- as.factor(fullTD3$pairCong)
levels(fullTD3$pairCong) <- c("NN", "PN", "PP")
fullTD3$pairCong <- relevel(fullTD3$pairCong, "PN")
fullTD3$chooseGroup <- as.factor(fullTD3$chooseGroup)
fullTD3$incong <- as.factor(ifelse(fullTD3$pair == "PN", "cong", "incong"))
fullTD3$SimRminL <- fullTD3$simR - fullTD3$simL

fullTD3$study <- "S3"

reValDf3$propT <- as.factor(reValDf3$propT)
levels(reValDf3$propT) <- c("Low","Med","High")
contrasts(reValDf3$propT) = contr.poly(levels(reValDf3$propT))

fullTD3$runSumRLDiff <- fullTD3$runSumR - fullTD3$runSumL

fullTD3$runSumRLDiff.Z <- scale(fullTD3$runSumRLDiff)
fullTD3$trialTotal.Z <- scale(fullTD3$trialTotal)
```

```{r,include=FALSE}
named.contr.sum<-function(x, ...) {
    if (is.factor(x)) {
        x <- levels(x)
    } else if (is.numeric(x) & length(x)==1L) {
        stop("cannot create names with integer value. Pass factor levels")
    }
    x<-contr.sum(x, ...)
    colnames(x) <- apply(x,2,function(x) 
         paste(names(x[x>0]))
    )
    x
}
```


```{r,include=FALSE}
fullTD <- data.frame(subID = c(fullTD1$subID, fullTD2$subID, fullTD3$subID), 
                     choice = c(fullTD1$choice, fullTD2$choice, fullTD3$choice),
                     chooseDes = c(fullTD1$chooseDes, fullTD2$chooseDes, fullTD3$chooseDes),
                     chooseGroup = c(fullTD1$chooseGroup, fullTD2$chooseGroup, fullTD3$chooseGroup),
                     desAP = c(fullTD1$desAP, fullTD2$desAP, fullTD3$desAP),
                     similarity = c(fullTD1$similarity, fullTD2$similarity, fullTD3$similarity),
                     AP = c(fullTD1$AP, fullTD2$AP, fullTD3$AP),
                     rAP = c(fullTD1$rAP, fullTD2$rAP, fullTD3$rAP),
                     SV.AP = c(fullTD1$SV.AP, fullTD2$SV.AP, fullTD3$SV.AP),
                     RSV.AP = c(fullTD1$RSV.AP, fullTD2$RSV.AP, fullTD3$RSV.AP),
                     condition = c(fullTD1$condition, fullTD2$condition, fullTD3$condition),
                     pair = c(fullTD1$pair, fullTD2$pair, fullTD3$pair),
                     trialTotal = c(fullTD1$trialTotal, fullTD2$trialTotal, fullTD3$trialTotal),
                     study = c(fullTD1$study, fullTD2$study, fullTD3$study),
                     compMotC = c(fullTD1$compMotC, fullTD2$compMotC, fullTD3$compMotC),
                     compMotC2 = c(fullTD1$compMotC2, fullTD2$compMotC2, fullTD3$compMotC2),
                     compMotC3 = c(fullTD1$compMotC3, fullTD2$compMotC3, fullTD3$compMotC3),
                     runAveCDiff = c(fullTD1$runAveCDiff, fullTD2$runAveCDiff, fullTD3$runAveCDiff),
                     rightDesAP = c(fullTD1$rightDesAP, fullTD2$rightDesAP, fullTD3$rightDesAP),
                     outDiff = c(fullTD1$outDiff, fullTD2$outDiff, fullTD3$outDiff),
                     inDiff = c(fullTD1$inDiff, fullTD2$inDiff, fullTD3$inDiff),
                     desEnt = c(fullTD1$desEnt, fullTD2$desEnt, fullTD3$desEnt),
                     aveEnt = c(fullTD1$aveEnt, fullTD2$aveEnt, fullTD3$aveEnt),
                     SE = c(fullTD1$SE, fullTD2$SE, fullTD3$SE)
                       )



fullTD$pair <- as.factor(fullTD$pair)
levels(fullTD$pair) <- c("NN", "PN", "PP")
fullTD$pair <- relevel(fullTD$pair, "PN")
fullTD$incong <- as.factor(ifelse(fullTD$pair == "PN", "incong", "cong"))

fullTD$condition <- as.factor(fullTD$condition)
fullTD$condition <- relevel(fullTD$condition, "Republican")
contrasts(fullTD$condition) <- contr.treatment(levels(fullTD$condition))

fullTD$conditionEC <- as.factor(fullTD$condition)
fullTD$conditionEC <- factor(fullTD$conditionEC, levels = c("Asian","Democrat","Latino","Republican"))
contrasts(fullTD$conditionEC) <- named.contr.sum(levels(fullTD$conditionEC))

fullTD$ingroup <- ifelse(fullTD$condition=="Republican", "Out", "In")

fullTD$chooseGroup <- as.factor(fullTD$chooseGroup)

fullTD$compMotC <- as.factor(fullTD$compMotC)
levels(fullTD$compMotC) <- c("Aligned", "Compete")
fullTD$compMotC2 <- as.factor(fullTD$compMotC2)
levels(fullTD$compMotC2) <- c("Aligned", "Compete")
fullTD$compMotC3 <- as.factor(fullTD$compMotC3)
levels(fullTD$compMotC3) <- c("Aligned", "Compete")
```

```{r,include=FALSE}
reValDf <- data.frame(subID = c(reValDf1$subID, reValDf2$subID, reValDf3$subID), 
                     traits = c(reValDf1$trait, reValDf2$trait, reValDf3$trait),
                     selfResp = c(reValDf1$selfResp, reValDf2$selfResp, reValDf3$selfResp),
                     valence = c(reValDf1$valence, reValDf2$valence, reValDf3$valence),
                     valEstF = c(reValDf1$valEstF, reValDf2$valEstF, reValDf3$valEstF),
                     aveCueF = c(reValDf1$aveCueF, reValDf2$aveCueF, reValDf3$aveCueF),
                     SV_F = c(reValDf1$SV_F, reValDf2$SV_F, reValDf3$SV_F),
                     condition = c(reValDf1$condition, reValDf2$condition, reValDf3$condition),
                     propT = c(reValDf1$propT, reValDf2$propT, reValDf3$propT),
                     outDegree = c(reValDf1$outDegree, reValDf2$outDegree, reValDf3$outDegree),
                     inDegree = c(reValDf1$inDegree, reValDf2$inDegree, reValDf3$inDegree),
                     inDegree = c(reValDf1$inDegree, reValDf2$inDegree, reValDf3$inDegree),
                     desirability = c(reValDf1$desirability, reValDf2$desirability, reValDf3$desirability),
                     unseen = c(reValDf1$unseen, reValDf2$unseen, reValDf3$unseen),
                     SE = c(reValDf1$SE, reValDf2$SE, reValDf3$SE)
)

reValDf$condition <- as.factor(reValDf$condition)
reValDf$condition <- relevel(reValDf$condition, "Republican")

reValDf$conditionEC <- as.factor(reValDf$condition)
reValDf$conditionEC <- factor(reValDf$conditionEC, levels = c("Asian","Democrat","Latino","Republican"))
contrasts(reValDf$conditionEC) <- named.contr.sum(levels(reValDf$conditionEC))

reValDf$ingroup <- ifelse(reValDf$condition=="Republican", "Out", "In")

reValDf$propT <- as.factor(reValDf$propT)
levels(reValDf$propT) <- c("Low","Med","High")
contrasts(reValDf$propT) = contr.poly(levels(reValDf$propT))
```


```{r,include=FALSE}
ppDf1 <- subset(fullTD1, pair == "PP")
incongDf1 <- subset(fullTD1, pair == "PN")
nnDf1 <- subset(fullTD1, pair == "NN")
congDf1 <- subset(fullTD1, pair == "PP" | pair == "NN")

ppDf2 <- subset(fullTD2, pair == "PP")
incongDf2 <- subset(fullTD2, pair == "PN")
nnDf2 <- subset(fullTD2, pair == "NN")
congDf2 <- subset(fullTD2, pair == "PP" | pair == "NN")

ppDf3 <- subset(fullTD3, pair == "PP")
incongDf3 <- subset(fullTD3, pair == "PN")
nnDf3 <- subset(fullTD3, pair == "NN")
congDf3 <- subset(fullTD3, pair == "PP" | pair == "NN")

ppDf <- subset(fullTD, pair == "PP")
incongDf <- subset(fullTD, pair == "PN")
nnDf <- subset(fullTD, pair == "NN")
congDf <- subset(fullTD, pair == "PP" | pair == "NN")
```

```{r}
psychCurve <- function(df, condition=F){
  
  APbins <- df %>% mutate(rank=ntile(df$rAP,100))
DESbins <- df %>% mutate(rank=ntile(df$rightDesAP,100))
FWSbins <- df %>% mutate(rank=ntile(df$RSV.AP,100))
  
  if(condition==F){

APranked <- APbins %>% group_by(rank) %>% summarise(nRight = mean(choice-1), nLeft = 1-mean(choice-1))
APranked$type <- "AP"
DESranked <- DESbins %>% group_by(rank) %>% summarise(nRight = mean(choice-1), nLeft = 1-mean(choice-1))
DESranked$type <- "DES"
FWSranked <- FWSbins %>% group_by(rank) %>% summarise(nRight = mean(choice-1), nLeft = 1-mean(choice-1))
FWSranked$type <- "FWS"
ranked <-rbind(APranked,DESranked,FWSranked)

xlabels <- sort(unique(ranked$rank))
xlabels <- paste0(xlabels,"%")
xlabels[c(2:9,11:19,21:29,31:39,41:49,51:59,61:69,71:79,81:89,91:99)] <- ""

psychometriCurve <- ggplot(ranked, aes(x=as.factor(rank), y=nRight, color=type, group=type)) + 
  geom_smooth(se=F) + 
  jtools::theme_apa() + 
  scale_x_discrete(name="Model Probability", labels = xlabels) + 
  scale_y_continuous(name="Choice Probability", breaks=seq(.10,1,by=.10), labels = paste0(seq(10,100,by=10),"%")) +
  theme(axis.ticks.x = element_blank(), axis.ticks.y=element_blank()) +
  scale_color_manual(labels = c("Mixture", "Desirability","Similarity-to-Group"), values = wes_palette("Darjeeling1"))
psychometriCurve

  }else if(condition==T){
  
APranked <- APbins %>% group_by(condition, rank) %>% summarise(nRight = mean(choice-1), nLeft = 1-mean(choice-1))
APranked$type <- "AP"
DESranked <- DESbins %>% group_by(condition, rank) %>% summarise(nRight = mean(choice-1), nLeft = 1-mean(choice-1))
DESranked$type <- "DES"
FWSranked <- FWSbins %>% group_by(condition, rank) %>% summarise(nRight = mean(choice-1), nLeft = 1-mean(choice-1))
FWSranked$type <- "FWS"
ranked <-rbind(APranked,DESranked,FWSranked)

xlabels <- sort(unique(ranked$rank))
xlabels <- paste0(xlabels,"%")
xlabels[c(2:9,11:19,21:29,31:39,41:49,51:59,61:69,71:79,81:89,91:99)] <- ""


ranked$condition_f = factor(ranked$condition, levels=c('Latino','Asian','Democrat','Republican'))
ranked$condition_f = recode_factor(ranked$condition_f, 'Latino' = "Latino (Study 1)", 'Asian' = "Asian (Study 2)", 'Democrat' = "Democrat (Study 3)", 'Republican' = "Republican (Study 3)")

psychometriCurve <- ggplot(ranked, aes(x=as.factor(rank), y=nRight, color=type, group=type, linetype = type)) + 
  facet_wrap( ~ condition_f ) +
  geom_smooth(se=F , aes(linetype=type)) + 
  jtools::theme_apa() + 
  scale_x_discrete(name="Model Probability", labels = xlabels) + 
  scale_y_continuous(name="Choice Probability", breaks=seq(.10,1,by=.10), labels = paste0(seq(10,100,by=10),"%")) +
  theme(axis.ticks.x = element_blank(), axis.ticks.y=element_blank()) +
  scale_color_manual(labels = c("Mixture", "Desirability","Similarity-to-Group"), values = wes_palette("Darjeeling1")) +
  scale_linetype_discrete(labels = c("Mixture", "Desirability","Similarity-to-Group")) +
  theme(legend.position="top", plot.margin = margin(11, 11, 10, 10), panel.spacing = unit(1.1, "lines"))
psychometriCurve
    
}
  
}

modelTD <- fullTD1
modelTD$choice <- as.numeric(modelTD$choice)

PSC1 <- psychCurve(modelTD)

modelTD <- fullTD2
modelTD$choice <- as.numeric(modelTD$choice)

PSC2 <- psychCurve(modelTD)

modelTD <- fullTD3
modelTD$choice <- as.numeric(modelTD$choice)

PSC3 <- psychCurve(modelTD, condition=T)

ggpubr::ggarrange(ggpubr::ggarrange(PSC1,PSC2, ncol=2,nrow=1, common.legend = T), PSC3, nrow=2, ncol=1, legend="none")

modelTD <- fullTD
modelTD$choice <- as.numeric(modelTD$choice)

PSCall <- psychCurve(modelTD, condition=T)
ggsave(paste0(plotDir, "PSC_comb.tiff"), PSCall, width = 8, height=5)
ggsave(paste0(plotDir, "PSC_comb.png"), PSCall, width = 8, height=5)
```

```{r}
desDF <- fullTD %>% 
  group_by(condition, subID, compMotC3) %>% 
  summarize(desChoice = mean(chooseDes), desAP = mean(desAP))

desDF <- fullTD %>% 
  group_by(condition, subID, incong, compMotC3) %>% 
  summarize(desChoice = mean(chooseDes), desAP = mean(desAP))

desDF$condition_f = factor(desDF$condition, levels=c('Latino','Asian','Democrat','Republican'))
desDF$condition_f = recode_factor(desDF$condition_f, 'Latino' = "Latino (Study 1)", 'Asian' = "Asian (Study 2)", 'Democrat' = "Democrat (Study 3)", 'Republican' = "Republican (Study 3)")

desCompMot <- ggplot(desDF, aes(compMotC3, desChoice, color=incong, fill = incong)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA, alpha = .3) +
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Proportion of Desirable Choices",x="Trial Type") + jtools::theme_apa() +
  facet_wrap(~condition_f) + 
  scale_color_manual(labels = c("Congruent", "Incongruent"), values = wes_palette("Chevalier1")) +
  scale_fill_manual(labels = c("Congruent", "Incongruent"), values = wes_palette("Chevalier1"))

ggsave(paste0(plotDir, "compMot_comb.tiff"), desCompMot, width = 8, height=5)
ggsave(paste0(plotDir, "compMot_comb.png"), desCompMot, width = 8, height=5)
```


# Descriptives of Computational Parameters

## Study 1

```{r}
psych::describe(params$Temp)
psych::describe(params$mix)
psych::describe(params$rb-1)
sd(params$rb-1)
```

## Study 2

```{r}
psych::describe(params2$Temp)
psych::describe(params2$mix)
psych::describe(params2$rb-1)
sd(params2$rb-1)
```

## Study 3

### Democrats

```{r}
psych::describe(params3_D$Temp)
psych::describe(params3_D$mix)
psych::describe(params3_D$rb-1)
```

### Republicans

```{r}
psych::describe(params3_R$Temp)
psych::describe(params3_R$mix)
psych::describe(params3_R$rb-1)
```

### Group Differences

```{r}
set.seed(52)
MKinfer::perm.t.test(params3_D$mix, params3_R$mix)
MKinfer::perm.t.test(params3_D$Temp, params3_R$Temp)
```


### Republicans

# Question 1: Does the tendency to choose the most desirable trait change across trials?

## Study 1

### For incongruent pairs, categorical choice: Desirable or not

```{r}
m <- glmer( chooseDes ~ scale(trialTotal) + ( scale(trialTotal) | subID), data = incongDf1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
```

### For all data, continuous desirability probability

```{r}
m <- lmer( desAP ~ scale(trialTotal) + ( scale(trialTotal) | subID), data = fullTD1)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

## Study 2

### For incongruent pairs, categorical choice: Desirable or not

```{r}
m <- glmer( chooseDes ~ scale(trialTotal) + ( scale(trialTotal) | subID), data = incongDf2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
```

### For all data, continuous desirability probability

```{r}
m <- lmer( desAP ~ scale(trialTotal) + ( scale(trialTotal) | subID), data = fullTD2)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

## Study 3

### For incongruent pairs, categorical choice: Desirable or not

```{r}
m <- glmer( chooseDes ~ scale(trialTotal) + ( scale(trialTotal) | subID), data = incongDf3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed",exponentiate=TRUE)
```

#### Between Conditions

```{r}
m <- glmer( chooseDes ~ scale(trialTotal)*condition + ( scale(trialTotal) | subID), data = incongDf3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed",exponentiate=TRUE)
```

### For all data, continuous desirability probability

```{r}
m <- lmer( desAP ~ scale(trialTotal) + ( scale(trialTotal) | subID), data = fullTD3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

##### Between conditions

```{r}
m <- lmer( desAP ~ scale(trialTotal)*condition + ( scale(trialTotal) | subID), data = fullTD3)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

# Question 2: Does average or cumulative group feedback predict choices?

## Study 1

### Average

```{r}
m <- glmer( choice ~ scale(trialTotal) + scale(runAveRLDiff) + ( scale(trialTotal) + scale(runAveRLDiff) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
```

### Summed

```{r}
m <- glmer( choice ~ scale(runSumRLDiff) + scale(trialTotal) + ( scale(trialTotal)  + scale(runSumRLDiff) + scale(propRminL) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
Sum1 <- ggpredict(m, c("runSumRLDiff")) %>% plot(show.title=F) + xlab("Summed Group Norms") + ylab("Choice Likelihood") + jtools::theme_apa()  
```

#### Moderated by incongruent pair

```{r}
m <- glmer( choice ~ runSumRLDiff.Z*incong + (runSumRLDiff.Z + incong | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
  summary(m)
  tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
  ggpredict(m, c("runSumRLDiff.Z","incong")) %>% plot()
  r2beta(m)
```


## Study 2

### Average

```{r}
m <- glmer( as.factor(choice) ~ scale(trialTotal) + scale(runAveRLDiff) + ( scale(trialTotal) + scale(runAveRLDiff) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
```

### Summed

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) + scale(trialTotal) + ( scale(trialTotal) + scale(runSumRLDiff) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
Sum2 <- ggpredict(m, c("runSumRLDiff")) %>% plot(show.title=F) + xlab("Summed Group Norms") + ylab("Choice Likelihood") + jtools::theme_apa()  
```

#### Moderated by incongruent pair

```{r}
m <- glmer( choice ~ runSumRLDiff.Z*incong + ( runSumRLDiff.Z + incong | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
  summary(m)
  tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
  ggpredict(m, c("runSumRLDiff.Z","incong")) %>% plot()
  r2beta(m)
```

## Study 3

### Average

```{r}
m <- glmer(  as.factor(choice) ~ scale(trialTotal) + scale(runAveRLDiff) + ( scale(trialTotal) + scale(runAveRLDiff) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
  tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
```

#### Between Conditions

```{r}
m <- glmer( as.factor(choice) ~ scale(trialTotal) + scale(runAveRLDiff)*condition + ( scale(trialTotal) + scale(runAveRLDiff) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
```

### Summed

```{r}
m <- glmer(  as.factor(choice) ~ scale(runSumRLDiff) + scale(trialTotal) + ( scale(trialTotal) + scale(runSumRLDiff) + scale(propRminL) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
Sum3 <- ggpredict(m, c("runSumRLDiff")) %>% plot(show.title=F) + xlab("Summed Group Norms") + ylab("Choice Likelihood") + jtools::theme_apa()  
```

#### Moderated by incongruent pair

```{r}
fullTD3$choice <- as.factor(fullTD3$choice)
m <- glmer( choice ~ runSumRLDiff.Z*incong + (  runSumRLDiff.Z + incong | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
ggpredict(m, c("runSumRLDiff.Z","incong")) %>% plot()
r2beta(m)
```

#### Between Conditions

```{r}
m <- glmer(  as.factor(choice) ~ scale(runSumRLDiff)*condition + scale(trialTotal) + ( scale(trialTotal) + scale(runSumRLDiff) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
ggpredict(m, c("runSumRLDiff","condition")) %>% plot()
```

## Combined Plot

```{r}
SumShared <- ggarrange(Sum1  + rremove("ylab") + rremove("xlab"),
                  Sum2 + rremove("ylab") + rremove("xlab"),
                  Sum3 + rremove("ylab") + rremove("xlab"), common.legend = T, ncol=3)
annotate_figure(SumShared, 
                left = textGrob("Likelihood Choice", rot = 90, vjust = .5, gp = gpar(cex = 1.3)),
                bottom = textGrob("Summed Group Norms", gp = gpar(cex = 1.3)))
ggsave("~/Documents/UC Riverside/Studies/Competing Motives Study/Manuscript/Figures/SumShared.tiff",dpi=600)
```


# Question 3: Do people self-derogate for traits that are representative of themselves and the group norm?

## Study 1

### For incongruent pairs, categorical choice: Desirable or not

```{r}
m <- glmer( chooseDes ~ compMotC3 + trialTotal.Z + ( compMotC3 + trialTotal.Z | subID), data = incongDf1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
ggpredict(m, c("compMotC3")) %>% plot()
r2beta(m)
```

### For all data, continuous desirability probability

```{r}
m <- lmer( scale(desAP) ~ compMotC3 + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD1)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
APCompMot1 <- ggpredict(m, c("compMotC3")) %>% plot(show.title=F) + xlab("Competing or Aligned Motivations") + ylab("Likelihood of Desirable Choice") + jtools::theme_apa()  
```

```{r}
m <- lmer( scale(desAP) ~ compMotC3 + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD1)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
APCompMot1 <- ggpredict(m, c("compMotC3")) %>% plot(show.title=F) + xlab("Competing or Aligned Motivations") + ylab("Likelihood of Desirable Choice") + jtools::theme_apa()  

```



#### Beta regression

```{r}
m <- glmmTMB( desAP ~ compMotC3 + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD1, family = beta_family())
tidy(m,conf.int=TRUE,effects="fixed")
APCompMot1 <- ggpredict(m, c("compMotC3")) %>% plot(show.title=F) + xlab("Competing or Aligned Motivations") + ylab("Likelihood of Desirable Choice") + jtools::theme_apa()
```

#### Logistic

```{r}
m <- glmer( chooseDes ~ compMotC3*incong + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
ggpredict(m, c("compMotC3","incong")) %>% plot()
```


## Study 2

### For incongruent pairs, categorical choice: Desirable or not

```{r}
m <- glmer( chooseDes ~ compMotC3 + trialTotal.Z + ( compMotC3 + trialTotal.Z | subID), data = incongDf2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
ggpredict(m, c("compMotC3")) %>% plot()
r2beta(m)
```

### For all data, continuous desirability probability

```{r}
m <- lmer( desAP ~ compMotC3 + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD2)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
APCompMot2 <- ggpredict(m, c("compMotC3")) %>% plot(show.title=F) + xlab("Competing or Aligned Motivations") + ylab("Likelihood of Desirable Choice") + jtools::theme_apa()  
```

#### Beta regression

```{r}
m <- glmmTMB( desAP ~ compMotC3 + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD2, family = beta_family())
tidy(m,conf.int=TRUE,effects="fixed")
APCompMot1 <- ggpredict(m, c("compMotC3")) %>% plot(show.title=F) + xlab("Competing or Aligned Motivations") + ylab("Likelihood of Desirable Choice") + jtools::theme_apa()  
```

#### Logistic

```{r}
m <- glmer( chooseDes ~ compMotC3*incong + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
ggpredict(m, c("compMotC3","incong")) %>% plot()
```

## Study 3

### For incongruent pairs, categorical choice: Desirable or not

```{r}
m <- glmer( chooseDes ~ compMotC3 + trialTotal.Z + ( compMotC3 + trialTotal.Z | subID), data = incongDf3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed",exponentiate=TRUE)
r2beta(m)
```

#### Condition Differences?

```{r}
m <- glmer( chooseDes ~ compMotC3 * condition + trialTotal.Z + ( compMotC3 + trialTotal.Z | subID), data = incongDf3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed",exponentiate=TRUE)
r2beta(m)
```


#### Beta regression

```{r}
m <- glmmTMB( desAP ~ compMotC3 + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD3, family = beta_family())
tidy(m,conf.int=TRUE,effects="fixed")
APCompMot1 <- ggpredict(m, c("compMotC3")) %>% plot(show.title=F) + xlab("Competing or Aligned Motivations") + ylab("Likelihood of Desirable Choice") + jtools::theme_apa()  
```

#### Between Conditions

```{r}
m <- glmmTMB( desAP ~ compMotC3*condition + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD3, family = beta_family())
tidy(m,conf.int=TRUE,effects="fixed")
APCompMot1 <- ggpredict(m, c("compMotC3")) %>% plot(show.title=F) + xlab("Competing or Aligned Motivations") + ylab("Relative Desirability") + jtools::theme_apa()  
```


#### Logistic

```{r}
m <- glmer( chooseDes ~ compMotC3*incong + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
ggpredict(m, c("compMotC3","incong")) %>% plot()
```

#### Between Conditions?

```{r}
m <- glmer( chooseDes ~ compMotC3*condition + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = incongDf3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("compMotC3","condition")) %>% plot()
```

### For all data, continuous desirability probability

```{r}
m <- lmer( desAP ~ compMotC3 + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
APCompMot3 <- ggpredict(m, c("compMotC3")) %>% plot(show.title=F) + xlab("Competing or Aligned Motivations") + ylab("Likelihood of Desirable Choice") + jtools::theme_apa()
```

#### Between conditions?

```{r}
m <- lmer( scale(desAP) ~ condition*compMotC3 + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD3)
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

## Combined Figure

```{r}
APCompMotShared <- ggarrange(APCompMot1  + rremove("ylab") + rremove("xlab"),
                  APCompMot2 + rremove("ylab") + rremove("xlab"),
                  APCompMot3 + rremove("ylab") + rremove("xlab"), common.legend = T, ncol=3)
annotate_figure(APCompMotShared, 
                left = textGrob("Likelihood of Choosing Desirable Trait", rot = 90, vjust = .5, gp = gpar(cex = 1.3)),
                bottom = textGrob("Aligned or Competing Motivations", gp = gpar(cex = 1.3)))
ggsave("~/Documents/UC Riverside/Studies/Competing Motives Study/Manuscript/Figures/APCompMotShared.tiff",dpi=600)
```


# Question 6: Does the model (mixture of category representativeness and desirability) predict choice, and is it not just similarity or desirability?

## Study 1

### Model Prediction

```{r}
m <- glmer( as.factor(choice) ~ scale(rAP) + ( scale(rAP) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD1)
ModelPlot1 <- ggpredict(m, c("rAP")) %>% plot(show.title=F) + xlab("Model Prediction") + ylab("Choice Likelihood") + jtools::theme_apa()  
```

### Feedback-Weighted Similarity and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(RSV.AP) + scale(rightDesAP) + ( scale(RSV.AP) + scale(rightDesAP) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD1)
```

### Summed Feedback, Averaged Similarity, and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD1)
```

#### Moderated by Self-Esteem

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) * SE + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD1)
ggpredict(m, c("runSumRLDiff","SE")) %>% plot(show.title=F)
```

### Summed Feedback, Averaged Similarity, and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(runAveRLDiff) + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD1)
```

## Study 2

### Model Prediction

```{r}
m <- glmer( as.factor(choice) ~ scale(rAP) + ( scale(rAP) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD2)
ModelPlot2 <- ggpredict(m, c("rAP")) %>% plot(show.title=F) + xlab("Model Prediction") + ylab("Choice Likelihood") + jtools::theme_apa()  
```

### Feedback-Weighted Similarity and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(RSV.AP) + scale(rightDesAP) + ( scale(RSV.AP) + scale(rightDesAP) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD2)
```

### Summed Feedback, Averaged Similarity, and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD2)
```

#### Moderated by Self-Esteem

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) * SE + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD1)
ggpredict(m, c("runSumRLDiff","SE")) %>% plot(show.title=F)
```

### Average Feedback, Averaged Similarity, and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(runAveRLDiff) + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD2)
```

## Study 3

### Model Prediction

```{r}
m <- glmer( as.factor(choice) ~ scale(rAP) + ( scale(rAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD3)
ModelPlot3 <- ggpredict(m, c("rAP")) %>% plot(show.title=F) + xlab("Model Prediction") + ylab("Choice Likelihood") + jtools::theme_apa()  
```

#### Between Conditions?

```{r}
m <- glmer( as.factor(choice) ~ scale(rAP)*condition + ( scale(rAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD3)
```

### Feedback-Weighted Similarity and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(RSV.AP) + scale(rightDesAP) + ( scale(RSV.AP) + scale(rightDesAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD3)
```

#### Between Conditions

```{r}
m <- glmer( as.factor(choice) ~ scale(RSV.AP)*condition + scale(rightDesAP) + ( scale(RSV.AP) + scale(rightDesAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD3)
```


### Summed Feedback, Averaged Similarity, and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD3)
```

#### Moderated by Self-Esteem

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) * SE * condition + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD1)
ggpredict(m, c("runSumRLDiff","SE","condition")) %>% plot(show.title=F)
```

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) * IdImp * condition + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD1)
ggpredict(m, c("runSumRLDiff","SE","condition")) %>% plot(show.title=F)
```

#### Between Conditions

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) * condition + scale(SimRminL) + condition + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
data.frame(r2beta(m,data=fullTD3))
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
```

```{r}
m <- glmer( as.factor(choice) ~ scale(runSumRLDiff) * condition + scale(SimRminL) + condition + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD3, family = binomial(link = "probit"), control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
data.frame(r2beta(m,data=fullTD3))
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
```

##### Plot

```{r}
m <- glmer( as.factor(choice) ~ runSumRLDiff * condition + SimRminL + condition + rightDesAP + ( runSumRLDiff + SimRminL + rightDesAP | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
p <- ggpredict(m, c("runSumRLDiff","condition"))
Cum.Cond <-ggplot(p, aes(x, predicted)) +  geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Ingroup (Democrat)","Outgroup (Republican)")) + scale_color_manual(labels = c("Ingroup (Democrat)","Outgroup (Republican)"), values = c("blue","red")) + scale_fill_manual( 
                      labels=c("Ingroup (Democrat)","Outgroup (Republican)"), values = c("blue","red")) + theme(
    legend.position = c(.1, .65),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Cumulative Group Probabilities (Right Relative to Left)") + ylab("Probability of Self-Endorsement")
Cum.Cond

ggsave(paste0(plotDir, "compMot_CondSum.tiff"), Cum.Cond, width = 8, height=5, dpi=600)
ggsave(paste0(plotDir, "compMot_CondSum.png"), Cum.Cond, width = 8, height=5, dpi=600)
```

### Average Feedback, Averaged Similarity, and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(runAveRLDiff) + scale(SimRminL) + scale(rightDesAP) + ( scale(runAveRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD3)
```

#### Between Conditions

```{r}
m <- glmer( as.factor(choice) ~ scale(runAveRLDiff)*condition + scale(SimRminL) + scale(rightDesAP) + ( scale(runSumRLDiff) + scale(SimRminL) + scale(rightDesAP) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tidy(m,conf.int=TRUE,exponentiate=TRUE,effects="fixed")
r2beta(m,data=fullTD3)
ggpredict(m, c("runAveRLDiff","condition")) %>% plot()
```


## Combined Plot

```{r}
ModelPlotShared <- ggarrange(ModelPlot1  + rremove("ylab") + rremove("xlab"),
                  ModelPlot1 + rremove("ylab") + rremove("xlab"),
                  ModelPlot1 + rremove("ylab") + rremove("xlab"), common.legend = T, ncol=3)
annotate_figure(ModelPlotShared, 
                left = textGrob("Choice Likelihood", rot = 90, vjust = .5, gp = gpar(cex = 1.3)),
                bottom = textGrob("Model Prediction", gp = gpar(cex = 1.3)))
ggsave("~/Documents/UC Riverside/Studies/Competing Motives Study/Manuscript/Figures/ModelPlotShared.tiff",dpi=600)
```


# Question 7: Does prior feedback observed during learning for each cue predict re-evaluations?

## Study 1

### Average

```{r}
m <- lmer( scale(selfResp) ~ scale(aveCueF) +
    ( scale(aveCueF) | subID) + (1 | trait), data = reValDf1, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("aveCueF")) %>% plot()
```

#### Moderated by Valence

```{r}
m <- lmer(selfResp ~ aveCueF*valence +
    ( aveCueF + valence | subID) + (1 | trait), data = reValDf1, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("aveCueF", "valence")) %>% plot()
```

### Summed

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + scale(propCueF) +
    ( scale(sumCueF) + scale(propCueF) | subID) + (1 | trait), data = reValDf1, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("sumCueF")) %>% plot()
```

#### Moderated by Valence

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) * valence + scale(propCueF) +
    ( valence + scale(sumCueF) + scale(propCueF) | subID) + (1 | trait), data = reValDf1, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("sumCueF","valence")) %>% plot()
```

##### Three-Way with Self-Esteem

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + valence + scale(propCueF) +
    ( valence + scale(sumCueF) + scale(propCueF) | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("sumCueF","valence","NTB")) %>% plot()
```

## Study 2

```{r}
m <- lmer( scale(selfResp) ~ scale(aveCueF) +
    ( scale(aveCueF) | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("aveCueF")) %>% plot()
```

### Moderated by valence

```{r}
m <- lmer( scale(selfResp) ~ scale(aveCueF) * valence +
    ( scale(aveCueF) + valence | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("aveCueF","valence")) %>% plot()
```

### Summed

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + scale(propCueF) +
    (  scale(sumCueF) + scale(propCueF) | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

#### Moderated by Valence

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) * valence + scale(propCueF) +
    (  scale(sumCueF) + valence + scale(propCueF) | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("sumCueF", "valence")) %>% plot()
```

## Study 3

### Average

```{r}
m <- lmer( scale(selfResp) ~ scale(aveCueF) +
    (  scale(aveCueF) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("aveCueF")) %>% plot()
```

#### Between Conditions?

```{r}
m <- lmer( scale(selfResp) ~ scale(aveCueF) * condition +
    ( scale(aveCueF) | subID) + ( condition | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("aveCueF","condition")) %>% plot()
```

#### Moderated by Valence

```{r}
m <- lmer( scale(selfResp) ~ scale(aveCueF) * valence +
    ( scale(aveCueF) + valence | subID) + ( condition | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("aveCueF","condition")) %>% plot()
```

##### Moderated by Valence and Condition

```{r}
m <- lmer( scale(selfResp) ~ scale(aveCueF) * valence * condition +
    ( scale(aveCueF) + valence | subID) + ( condition | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("sumCueF","condition")) %>% plot()
```

### Summed

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + scale(propCueF) +
    (  scale(sumCueF) + scale(propCueF) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("sumCueF")) %>% plot()
tidy(m,conf.int=TRUE,effects="fixed")
```

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF)*scale(IdImp) + scale(propCueF) +
    (  scale(sumCueF) + scale(propCueF) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("sumCueF")) %>% plot()
tidy(m,conf.int=TRUE,effects="fixed")
```

#### Between Conditions?

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) * condition + scale(propCueF) +
    ( scale(sumCueF) + scale(propCueF) | subID) + ( condition | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("sumCueF","condition")) %>% plot()
```

#### Moderated by Valence

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) * valence + scale(propCueF) +
    ( scale(sumCueF) + valence + scale(propCueF) | subID) + ( 1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("sumCueF","valence")) %>% plot()
```

##### Moderated by Valence and Condition

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) * valence * condition +
    ( scale(sumCueF) + valence | subID) + ( condition | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("sumCueF","condition")) %>% plot()
```

# Question 9: Does final value estimate predict re-evaluations?

## Study 1

### Full model

```{r}
m <- lmer(selfResp ~ scale(valEstF) +
    ( scale(valEstF) | subID) + (1 | trait), data = reValDf1, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ModelRePlot1 <- ggpredict(m, c("valEstF")) %>% plot(show.title=F) + xlab("Model Prediction") + ylab("Self-Evaluation") + jtools::theme_apa()  
r2beta(m)
```

### Feedback-Weighted Similarity and Desirability

```{r}
m <- lmer(scale(selfResp) ~ scale(SV_F) + scale(desirability) +
    ( scale(SV_F) + scale(desirability) | subID) + (1 | trait), data = reValDf1, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("SV_F")) %>% plot()
r2beta(m)
```

### Cumulative Norms, Similarity, and Desirability

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + scale(Sim) + scale(desirability) +
    ( scale(sumCueF) + scale(Sim) + scale(desirability) | subID) + (1 | trait), data = reValDf1, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
r2beta(m)
```

### Cumulative Norms and Desirability

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + scale(desirability) +
    ( scale(sumCueF)  + scale(desirability) | subID) + (1 | trait), data = reValDf1, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

## Study 2

### Full model

```{r}
m <- lmer(scale(selfResp) ~ scale(valEstF) +
    ( scale(valEstF) | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ModelRePlot2 <- ggpredict(m, c("valEstF")) %>% plot(show.title=F) + xlab("Model Prediction") + ylab("Self-Evaluation") + jtools::theme_apa() 
r2beta(m)
```

### Feedback-Weighted Similarity and Desirability

```{r}
m <- lmer(scale(selfResp) ~ scale(SV_F) + scale(desirability) +
    ( scale(SV_F) + scale(desirability) | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("SV_F")) %>% plot()
r2beta(m)
```

### Cumulative Norms, Similarity, and Desirability

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + scale(Sim) + scale(desirability) +
    ( scale(sumCueF) + scale(Sim) + scale(desirability) | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
r2beta(m)
```

## Study 3

### Full model

```{r}
m <- lmer( scale(selfResp) ~ scale(valEstF) +
    ( scale(valEstF) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ModelRePlot3 <- ggpredict(m, c("valEstF")) %>% plot(show.title=F) + xlab("Model Prediction") + ylab("Self-Evaluation") + jtools::theme_apa() 
```

#### Between conditions?

```{r}
m <- lmer( scale(selfResp) ~ scale(valEstF)*condition +
    ( valEstF | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("valEstF")) %>% plot()
r2beta(m)
```

### Feedback-Weighted Similarity and Desirability

```{r}
m <- lmer( scale(selfResp) ~ scale(SV_F) + scale(desirability) +
    ( scale(SV_F) + scale(desirability) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("SV_F")) %>% plot()
r2beta(m)
```

### Cumulative Norms, Similarity, and Desirability

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + scale(Sim) + scale(desirability) +
    ( scale(sumCueF) + scale(Sim) + scale(desirability) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
r2beta(m)
```

#### Between conditions?

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF)*condition + scale(Sim) + scale(desirability) +
    ( scale(sumCueF) + scale(Sim) + scale(desirability) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
r2beta(m)
```

### Cumulative Norms, Similarity, and Desirability

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + scale(Sim) + scale(desirability) +
    ( scale(sumCueF) + scale(Sim) + scale(desirability) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

#### Between conditions?

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) * condition + scale(Sim) + scale(desirability) +
    ( scale(sumCueF) + scale(Sim) + scale(desirability) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

### Cumulative Norms and Desirability

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) + scale(desirability) +
    ( scale(sumCueF) + scale(desirability) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

#### Between Conditions

```{r}
m <- lmer( scale(selfResp) ~ scale(sumCueF) * condition + scale(desirability) +
    ( scale(sumCueF) + scale(desirability) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
```

## Combined Plot

```{r}
ModelReShared <- ggarrange(ModelRePlot1  + rremove("ylab") + rremove("xlab"),
                  ModelRePlot2 + rremove("ylab") + rremove("xlab"),
                  ModelRePlot3 + rremove("ylab") + rremove("xlab"), common.legend = T, ncol=3)
annotate_figure(ModelReShared, 
                left = textGrob("Self-Evaluation", rot = 90, vjust = .5, gp = gpar(cex = 1.3)),
                bottom = textGrob("Model Prediction", gp = gpar(cex = 1.3)))
ggsave("~/Documents/UC Riverside/Studies/Competing Motives Study/Manuscript/Figures/ModelReShared.tiff",dpi=600)
```


# Question 10: Does the effect of category representativeness on re-evaluations depend on whether trait feedback was observed during learning or can people generalize to unseen traits?

## Study 1: Not applicable

Not applicable

## Study 2

### Summed Feedback

```{r}
m <- lmer(scale(selfResp) ~ scale(sumCueF)*as.factor(unseen) +
    ( scale(sumCueF) + as.factor(unseen) | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("sumCueF", "unseen" )) %>% plot()
parameters::equivalence_test(m)
```

### Feedback-Weighted Similarity

Steeper slope for unseen traits. Unseen traits with low category representativeness are even less descriptive.

```{r}
m <- lmer(scale(selfResp) ~ scale(SV_F)*as.factor(unseen) + scale(desirability) +
    ( scale(SV_F) + as.factor(unseen) + scale(desirability) | subID) + (1 | trait), data = reValDf2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("SV_F", "unseen" )) %>% plot()
r2beta(m)
parameters::equivalence_test(m)
```

#### Simple Effects

```{r}
n2 <- subset(reValDf2, unseen==1)
p2 <- subset(reValDf2, unseen==0)

m <- lmer(scale(selfResp) ~ scale(SV_F) + scale(desirability) +
    ( scale(SV_F) + scale(desirability) | subID) + (1 | trait), data = n2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
r2beta(m)

m <- lmer(scale(selfResp) ~ scale(SV_F) + scale(desirability) +
    ( scale(SV_F) + scale(desirability) | subID) + (1 | trait), data = p2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
r2beta(m)
```


## Study 3

### Summed Feedback

```{r}
m <- lmer(scale(selfResp) ~ scale(sumCueF)*as.factor(unseen) + scale(propCueF) +
    ( scale(sumCueF) + as.factor(unseen) + scale(propCueF) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("sumCueF", "unseen" )) %>% plot()
parameters::equivalence_test(m)
```

#### Different between conditions

```{r}
m <- lmer(scale(selfResp) ~ scale(sumCueF)*as.factor(unseen)*condition +
    ( scale(sumCueF) + as.factor(unseen) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("sumCueF", "unseen", "condition" )) %>% plot()
```

### Feedback-Weighted Similarity

```{r}
m <- lmer(scale(selfResp) ~ scale(SV_F)*as.factor(unseen) + scale(desirability) +
    ( scale(SV_F) + as.factor(unseen) + scale(desirability) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
ggpredict(m, c("SV_F", "unseen" )) %>% plot()
r2beta(m)
parameters::equivalence_test(m)
```

#### Different between conditions

```{r}
m <- lmer(scale(selfResp) ~ scale(SV_F)*as.factor(unseen)*condition + scale(desirability) +
    ( scale(SV_F) + as.factor(unseen) + scale(desirability) | subID) + (1 | trait), data = reValDf3, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
ggpredict(m, c("SV_F", "unseen", "condition")) %>% plot()
```

#### Simple Effects

```{r}
n2 <- subset(reValDf3, unseen==1)
p2 <- subset(reValDf3, unseen==0)

m <- lmer(scale(selfResp) ~ scale(SV_F) + scale(desirability) +
    ( scale(SV_F) + scale(desirability) | subID) + (1 | trait), data = n2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
r2beta(m)

m <- lmer(scale(selfResp) ~ scale(SV_F) + scale(desirability) +
    ( scale(SV_F) + scale(desirability) | subID) + (1 | trait), data = p2, control = lmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)))
summary(m)
tidy(m,conf.int=TRUE,effects="fixed")
r2beta(m)
```

# Exploratory Analyses

## Effect of Similarity-to-Group Stronger for Lower Self-Esteem Individuals

```{r}
m <- glmer( as.factor(choice) ~ scale(RSV)*SE + scale(desRminL)*SE + cong + scale(trialTotal) + ( scale(RSV) + scale(desRminL) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
r2beta(m,data=fullTD1)
ggpredict(m, c("RSV","SE")) %>% plot()
ggpredict(m, c("desRminL","SE")) %>% plot()

m <- glmer( as.factor(choice) ~ scale(RSV)*SE + scale(desRminL)*SE + cong + scale(trialTotal) + ( scale(RSV) + scale(desRminL) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
r2beta(m,data=fullTD2)
ggpredict(m, c("RSV","SE")) %>% plot()
ggpredict(m, c("desRminL","SE")) %>% plot()


m <- glmer( as.factor(choice) ~ scale(RSV)*SE*condition + scale(desRminL)*SE*condition + cong + scale(trialTotal) + ( scale(RSV) + scale(desRminL) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("RSV","SE","condition")) %>% plot()
ggpredict(m, c("desRminL","SE","condition")) %>% plot()
```

### Plot

```{r}
SVD.SE1 <- glmer( as.factor(choice) ~ RSV*SE + desRminL*SE + cong + trialTotal + ( RSV + desRminL | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)



SVD.SE2 <- glmer( as.factor(choice) ~ RSV*SE + desRminL*SE + cong + trialTotal + ( scale(RSV) + scale(desRminL) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)


SVD.SE3 <- glmer( as.factor(choice) ~ RSV*SE*condition + desRminL*SE*condition + cong + trialTotal + ( RSV + desRminL | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)

repDf3 <- subset(fullTD3, condition=="Republican")
demDf3 <- subset(fullTD3, condition=="Democrat")

SVD.SE3r <- glmer( as.factor(choice) ~ RSV*SE + desRminL*SE + cong + trialTotal + ( RSV + desRminL | subID), data = repDf3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)

SVD.SE3d <- glmer( as.factor(choice) ~ RSV*SE + desRminL*SE + cong + trialTotal + ( RSV + desRminL | subID), data = demDf3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
```

theme(plot.title = element_text(hjust = 0.5))

+
  ggtitle("Average bill for 2 people") +
  ggeasy::easy_center_title()

```{r}
p <- ggpredict(SVD.SE1, c("RSV","SE"))
SVD.SE1.Plot <-ggplot(p, aes(x, predicted)) +  geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem")) + scale_color_manual(labels = c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem"), values = wes_palette("FantasticFox1") ) + scale_fill_manual( 
                      labels=c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem"), values = wes_palette("FantasticFox1") ) + theme(
    legend.position = c(.65, .1),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Similarity-to-Self (Right Relative to Left)") + ylab("Choice Probability") +
  ggtitle("Latino (Study 1)") +
  ggeasy::easy_center_title() +
  theme(plot.title = element_text(size=12))

SVD.SE1.Plot

p <- ggpredict(SVD.SE2, c("RSV","SE"))
SVD.SE2.Plot <-ggplot(p, aes(x, predicted)) +  geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem")) + scale_color_manual(labels = c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem"), values = wes_palette("FantasticFox1") ) + scale_fill_manual( 
                      labels=c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem"), values = wes_palette("FantasticFox1") ) + theme(
    legend.position = c(.65, .1),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Similarity-to-Self (Right Relative to Left)") + ylab("Choice Probability") +
  ggtitle("Asian (Study 2)") +
  ggeasy::easy_center_title() +
  theme(plot.title = element_text(size=12))
SVD.SE2.Plot

p <- ggpredict(SVD.SE3d, c("RSV","SE"))
SVD.SE3d.Plot <-ggplot(p, aes(x, predicted)) +  geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem")) + scale_color_manual(labels = c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem"), values = wes_palette("FantasticFox1") ) + scale_fill_manual( 
                      labels=c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem"), values = wes_palette("FantasticFox1") ) + theme(
    legend.position = c(.65, .1),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Similarity-to-Self (Right Relative to Left)") + ylab("Choice Probability") +
  ggtitle("Democrat (Study 3)") +
  ggeasy::easy_center_title() +
  theme(plot.title = element_text(size=12))
SVD.SE3d.Plot

p <- ggpredict(SVD.SE3r, c("RSV","SE"))
SVD.SE3r.Plot <-ggplot(p, aes(x, predicted)) +  geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem")) + scale_color_manual(labels = c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem"), values = wes_palette("FantasticFox1") ) + scale_fill_manual( 
                      labels=c("Low Self-Esteem","Moderate Self-Esteem","High Self-Esteem"), values = wes_palette("FantasticFox1") ) + theme(
    legend.position = c(.65, .1),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Similarity-to-Self (Right Relative to Left)") + ylab("Choice Probability")  +
  ggtitle("Republican (Study 3)") +
  ggeasy::easy_center_title() +
  theme(plot.title = element_text(size=12))
SVD.SE3r.Plot

arranged <- ggarrange(SVD.SE1.Plot + rremove("ylab") + rremove("xlab"), SVD.SE2.Plot + rremove("ylab") + rremove("xlab"), SVD.SE3d.Plot + rremove("ylab") + rremove("xlab"), SVD.SE3r.Plot + rremove("ylab") + rremove("xlab"), ncol =2, nrow = 2, hjust=.42, common.legend = T)
addedAxes <- annotate_figure(arranged, left = textGrob("Probability of Desirable Choice", rot = 90, vjust = 1, hjust = .4, gp = gpar(cex = 1.3, fontsize=8, fontface=2)),
                               bottom = textGrob("Similarity-to-Group (Right Relative to Left)", vjust = -.25, gp = gpar(cex = 1.3, fontsize=8, fontface=2))
  )

ggsave(paste0(plotDir, "RSV123_SE.tiff"), addedAxes, width = 8, height=5, dpi=600)
ggsave(paste0(plotDir, "RSV123_SE.png"), addedAxes, width = 8, height=5, dpi=600)
```



## Effect of Social Identification on Similarity-to-Group and Desirability

```{r}
m <- glmer( as.factor(choice) ~ scale(RSV)*IdImp + scale(desRminL)*IdImp + cong + scale(trialTotal) + ( scale(RSV) + scale(desRminL) | subID), data = fullTD1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
r2beta(m,data=fullTD1)
ggpredict(m, c("RSV","IdImp")) %>% plot()
ggpredict(m, c("desRminL","IdImp")) %>% plot()

m <- glmer( as.factor(choice) ~ scale(RSV)*IdImp + scale(desRminL)*IdImp + cong + scale(trialTotal) + ( scale(RSV) + scale(desRminL) | subID), data = fullTD2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
r2beta(m,data=fullTD2)
ggpredict(m, c("RSV","IdImp")) %>% plot()
ggpredict(m, c("desRminL","IdImp")) %>% plot()


m <- glmer( as.factor(choice) ~ scale(RSV)*IdImp*condition + scale(desRminL)*IdImp*condition + cong + scale(trialTotal) + ( scale(RSV) + scale(desRminL) | subID), data = fullTD3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("RSV","IdImp","condition")) %>% plot()
ggpredict(m, c("desRminL","IdImp","condition")) %>% plot()
```

## Lower Self-Esteem Individuals Self-Derogate for Group Less and Self-Derogation Effect Weaker for Republican Outgroup

```{r}
CM.SE1 <- glmer( as.factor(chooseDes) ~ compMotC3*SE + cong + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD1, family=binomial)
summary(CM.SE1)

CM.SE2 <- glmer( as.factor(chooseDes) ~ compMotC3*SE + cong + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD2, family=binomial)
summary(CM.SE2)

CM.SE3 <- glmer( as.factor(chooseDes) ~ compMotC3*SE*condition + cong + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD3, family=binomial)
summary(CM.SE3)
```

### Plot

```{r}
CM.SE1.m.plot <- glmer( as.factor(chooseDes) ~ compMotC3*SE + cong + trialTotal + ( compMotC3 + scale(trialTotal) | subID), data = fullTD1, family=binomial)

CM.SE2.m.plot <- glmer( as.factor(chooseDes) ~ compMotC3*SE + cong + trialTotal + ( compMotC3 + scale(trialTotal) | subID), data = fullTD2, family=binomial)

CM.SE3.m.plot <- glmer( as.factor(chooseDes) ~ compMotC3*SE*condition + cong + trialTotal + ( compMotC3 + scale(trialTotal) | subID), data = fullTD3, family=binomial)
```


```{r}
p <- ggpredict(CM.SE1.m.plot, c("SE","compMotC3"))
CM.SE1.Plot <-ggplot(p, aes(x, predicted)) +  geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Aligned","Compete")) + scale_color_manual(labels = c("Aligned","Compete"), values = wes_palette("Cavalcanti1") ) + scale_fill_manual( 
                      labels=c("Aligned","Compete"), values = wes_palette("Cavalcanti1") ) + theme(
    legend.position = c(.65, .1),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Self-Esteem") + ylab("Probability of Desirable Choice")  +
  ggtitle("Latino (Study 1)") +
  ggeasy::easy_center_title() +
  theme(plot.title = element_text(size=12))
CM.SE1.Plot

p <- ggpredict(CM.SE2.m.plot, c("SE","compMotC3"))
CM.SE2.Plot <-ggplot(p, aes(x, predicted)) +  geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Aligned","Compete")) + scale_color_manual(labels = c("Aligned","Compete"), values = wes_palette("Cavalcanti1") ) + scale_fill_manual( 
                      labels=c("Aligned","Compete"), values = wes_palette("Cavalcanti1") ) + theme(
    legend.position = c(.65, .1),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Self-Esteem") + ylab("Probability of Desirable Choice")  +
  ggtitle("Asian (Study 2)") +
  ggeasy::easy_center_title() +
  theme(plot.title = element_text(size=12))

p <- ggpredict(CM.SE3.m.plot, c("SE","compMotC3","condition"))
CM.SE3.Plot <-ggplot(p, aes(x, predicted)) + geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Aligned","Compete")) + scale_color_manual(labels = c("Aligned","Compete"), values = wes_palette("Cavalcanti1") ) + scale_fill_manual( 
                      labels=c("Aligned","Compete"), values = wes_palette("Cavalcanti1") ) + theme(
    legend.position = c(.65, .1),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Self-Esteem") + ylab("Probability of Desirable Choice") + facet_wrap(~facet)
```

### Combined

```{r}
arranged <- ggarrange(CM.SE1.Plot + rremove("ylab") + rremove("xlab"), CM.SE2.Plot + rremove("ylab") + rremove("xlab"), ncol =2, nrow = 1, hjust=.42, common.legend = T)
addedAxes <- annotate_figure(arranged, left = textGrob("Probability of Desirable Choice", rot = 90, vjust = 1, hjust = .4, gp = gpar(cex = 1.3, fontsize=8, fontface=2)),
                               bottom = textGrob("Self-Esteem", vjust = -.25, gp = gpar(cex = 1.3, fontsize=8, fontface=2))
  )

ggsave(paste0(plotDir, "compMot12_SE.tiff"), addedAxes, width = 6.5, height=3, dpi=600)
ggsave(paste0(plotDir, "compMot12_SE.png"), addedAxes, width = 6.5, height=3, dpi=600)
```


## Social Identification Moderates Self-Derogation for Ingroup but Not Outgroup

# Lower Self-Esteem Individuals Self-Derogate for Group Less and Self-Derogation Effect Weaker for Republican Outgroup

```{r}
m <- glmer( as.factor(chooseDes) ~ compMotC3*IdImp + cong + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD1, family=binomial)
summary(m)
ggpredict(m, c("IdImp","compMotC3")) %>% plot()

m <- glmer( as.factor(chooseDes) ~ compMotC3*IdImp + cong + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD2, family=binomial)
summary(m)
ggpredict(m, c("IdImp","compMotC3")) %>% plot()

m <- glmer( as.factor(chooseDes) ~ compMotC3*IdImp*condition + cong + scale(trialTotal) + ( compMotC3 + scale(trialTotal) | subID), data = fullTD3, family=binomial)
summary(m)
ggpredict(m, c("IdImp","compMotC3","condition")) %>% plot()
```

## Plot

```{r}
CM.Id3 <- glmer( as.factor(chooseDes) ~ compMotC3*IdImp*condition + cong + trialTotal + ( compMotC3 + trialTotal | subID), data = fullTD3, family=binomial)
CM.Id3 <- glmer( as.factor(chooseDes) ~ compMotC3*SE*condition + cong + trialTotal + ( compMotC3 + scale(trialTotal) | subID), data = fullTD3, family=binomial)
p <- ggpredict(CM.Id3, c("IdImp","compMotC3","condition"))
CM.Id3.Plot <-ggplot(p, aes(x, predicted)) + geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Aligned","Compete")) + scale_color_manual(labels = c("Aligned","Compete"), values = wes_palette("Cavalcanti1") ) + scale_fill_manual( 
                      labels=c("Aligned","Compete"), values = wes_palette("Cavalcanti1") ) + theme(
    legend.position = c(.65, .1),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Social Identification") + ylab("Probability of Desirable Choice") + facet_wrap(~facet)

arranged <- ggarrange(CM.SE3.Plot + rremove("ylab"), CM.Id3.Plot + rremove("ylab"), ncol =1, nrow = 2, hjust=.42, common.legend = T)

addedAxes <- annotate_figure(arranged, left = textGrob("Probability of Desirable Choice", rot = 90, vjust = 1, hjust = .525, gp = gpar(cex = 1.3, fontsize=8, fontface=2))
)

ggsave(paste0(plotDir, "compMot3_SEId.tiff"), addedAxes, width = 6.5, height=5, dpi=600)
ggsave(paste0(plotDir, "compMot3_SEId.png"), addedAxes, width = 6.5, height=5, dpi=600)
```


## Compete-Align Moderated by Self-Esteem

```{r}
m <- lmer(scale(sumC.AP) ~ scale(SE) * compMotC3 * condition + scale(trialTotal) + ( compMotC3 | subID), data = fullTD3)
summary(m)
ggpredict(m, c("SE","compMotC3", "condition")) %>% plot(show.title=F) + xlab("Self-Esteem") + ylab("Likelihood of Group Normativity") + jtools::theme_apa()
```

```{r}
m <- lmer(scale(desAP) ~ compMotC3 * condition * IdImp + scale(trialTotal) + ( compMotC3 | subID), data = fullTD3)
summary(m)
ggpredict(m, c("SE","compMotC3", "condition")) %>% plot(show.title=F) + xlab("Self-Esteem") + ylab("Likelihood of Group Normativity") + jtools::theme_apa()
```

## Likelihood of endorsing group normative trait predicted by strength of id, moderated by condition

```{r}
m <- lmer(scale(sumC.AP) ~ scale(IdImp) * condition + ( 1 | subID), data = fullTD3)
summary(m)
ggpredict(m, c("IdImp", "condition")) %>% plot(show.title=F) + xlab("Strength of Identification") + ylab("Likelihood of Group Normativity") + jtools::theme_apa()
```

